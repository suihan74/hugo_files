---
title: "Satena - はてなブックマーク クライアントアプリ"
description: "Android用オレオレはてブアプリの開発まとめ"
tags: ["Android","Satena","はてなブックマーク"]
date: 2020-08-01T21:40:00+09:00
lastmod: 2020-08-12T15:55:00+09:00
archives:
    - 2020
    - 2020-08
    - 2020-08-01
hide_overview: false
draft: false
---

<div class="appreach"><img src="https://lh3.googleusercontent.com/8s4Fzo7AmnoNOT-pbsRoBSYbmBFgfS98l0Qatr1-aHYCRUJlHwab6jB1rijGC1_FYA=s128" alt="Satena - はてなブックマーククライアント, はてブビューア" class="appreach__icon"><div class="appreach__detail" style=""><p class="appreach__name">Satena - はてなブックマーククライアント, はてブビューア</p><p class="appreach__info"><span class="appreach__developper">すいはん</span><span class="appreach__price">無料</span><span class="appreach__posted">posted with<a href="https://mama-hack.com/app-reach/" title="アプリーチ" target="_blank" rel="nofollow">アプリーチ</a></span></p></div><div class="appreach__links" style=""><a href="https://play.google.com/store/apps/details?id=com.suihan74.satena" target="_blank" rel="nofollow" class="appreach__gplink"><img src="https://nabettu.github.io/appreach/img/gplay_ja.png"></a></div></div>

概ね去年2019年の8月末頃から開発を始めて、同9月中頃よりストアで公開しているAndroidではてブやるやつ「Satena」なのだが、特にこれと言って紹介ページとか作っていなかったし、リリースノートは毎度うまくまとまらなくてしんどいし、計画的にカッチリ作っているわけでもないのでいい加減自分でも何やったか把握しきれなくなりつつあるので、ここらで記事にしておこうとか思ったのがコレというわけです。

-> [次の機能追加バージョンの開発状況](#次バージョン開発状況) (不定期)

---

## アプリ更新履歴

[Satena/release_notes.txt at master · suihan74/Satena](https://github.com/suihan74/Satena/blob/master/app/src/main/res/raw/release_notes.txt)

---

## ソースコード

[suihan74/Satena: Android用オレオレはてブビューア](https://github.com/suihan74/Satena)

---

## 動作環境

- Android 6.0(M)以上 (minSdkVersion:23, targetSdkVersion:29)

  バニラなAndroid 6、Android 10 (API29)、あとは常用のOPPO RenoA(Android 9)ではテストしているものの、極たまに来るクラッシュレポート読む以外は他環境はろくに知らないので何かあったら教えてほしい（）

- スマホ想定

  タブレット向けのレイアウトはとくに用意していないが、まぁ動かないということはない。(はず)

## 開発環境

- AndroidStudio 4.0.x

- kotlin 1.3.72

- Android Gradle Plugin 4.0.0

---

## アプリ側で実現している機能

はてなブックマークで提供されている機能の他に、Satenaの独自機能が幾つかあります。

### ダークテーマ

黒い画面は好きです。  
一方で自分があまり白いテーマを使わないこともあり、色の組み合わせとかの問題でアクセシビリティの警告を幾らか食らっています。いつか直すかもしれないし直さないかもしれない。

{{<img src="light.png" zoom=".5" title="light theme">}}

{{<img src="dark.png" zoom=".5" title="dark theme">}}

### Mastodon連携

はてブで元々同時投稿できるTwitter,Facebookに加えて、Mastodonのアカウントを認証させることでそちらにも同時投稿できます。  
Mastodonへの投稿は、はてなではなくアプリで生成している都合上それに含まれるリンクははてなの短縮URLではなくナマのURLになります。

Mastodonのアカウントも他同様1件のみ連携可能。  
連合TLなどに同一投稿が複数並ぶのが嫌いなので、今後も複垢連携に対応する予定はありません。

{{<img src="post_dialog.png" zoom=".5" title="post dialog">}}

### NGワード・非表示サイト

エントリ一覧に表示しないURL(前方一致)や、NGワード(部分一致)を設定できます。  
たとえば、虚構新聞の記事（ttps://kyoko-np.net/~~~.html）を非表示にしたい場合は、非表示URLに"kyoko-np.net"を追加するとエントリ一覧に表示されなくなります。例に他意はありません。

NGワードは単純に見たくない単語などを追加すればいいわけですが、各ワードに対して「エントリに適用するか」「ブコメに適用するか」を指定することができます。

{{<img src="ignore_url.png" zoom=".5" title="非表示URL">}}

{{<img src="ignore_text.png" zoom=".5" title="NGワード">}}

### ホームカテゴリの変更

好きなカテゴリを起動時に表示できます。  
現在のところサブカテゴリや検索クエリなどは初期値を指定できないので、気が向いたらなんとかするかもしれません。

### エントリをタップした時の挙動のカスタマイズ

シングルタップ時とロングタップ時の挙動を「ブコメ一覧を開く」「ページを内部ブラウザで開く」「ページを外部ブラウザで開く」「メニューダイアログを開く」の中からユーザーが設定できます。

「ページかブコメくらいは読んでからブコメ書けや」という思想から、エントリ一覧画面から直接ブクマ投稿する機能は意図的に用意していません。  
(「あとで読む」→「読んだ」の挙動設定によっては一応できる)

### 最近つけたスター・スターレポート

エントリ画面のカテゴリから「スター」を選択すると閲覧できます。  
それぞれ「最近自分が付けたスター」「最近他人から付けられたスター」があるエントリの一覧です。

### ブクマ閲覧履歴

Satena内でブクマ一覧画面を開いたエントリは直近何件か(デフォルトでは10件)は記憶され、「ブクマ閲覧履歴」カテゴリで閲覧できます。

### ユーザーに対するタグ付け

ユーザータグと呼んでいる機能。  
たとえば「面白」とかタグを作成して、「この人よく面白いこと言ってるな」とか思ったらそのユーザーに「面白」タグを付けます。その他色々用途はお察しください。  
後述のカスタムブコメリストと組み合わせることで、ブコメリストのフィルタリングにも使えます。

設定画面では各タグが付いたユーザーの一覧を確認・編集することができます。

### カスタムブコメリスト

ブコメ一覧画面のタブは、はてブ公式同様の「人気」「新着」の他に、「すべて」「カスタム」があります。

- 「すべて」タブ

  ブコメの有無に関わらず全てのブクマを表示します。(無言ブクマも含む新着順)  
  設定画面で振る舞いを変更できますが、「非表示ユーザー」や「NGワードを含むブコメ」も全て表示できます。

- 「カスタム」タブ

  表示するユーザーをユーザータグで制御できます。  
  「タグAが付いたユーザーは表示する」「タグBが付いたユーザーは表示しない」「タグが未だ付いていないユーザーは表示する」など細かく指定できます。

{{<img src="custom_tab.png" zoom=".5" title="カスタムタブ設定">}}

### ブコメ詳細画面

リストの各ブコメを選択すると、そのブコメについての詳細情報を閲覧できます。  
現在のところこの画面では、

- 選択ブコメに付いたスターの一覧と、それを付けたユーザーが現在のページをブクマしている場合そのブコメを表示する

- 選択ブコメを書いたユーザーがスターを付けた(現在のページに対する)他のブコメ一覧

- 選択ブコメに対するIDコールが含まれるブコメ一覧

- 選択ブコメがIDコールしている他のブコメ一覧

……が閲覧できます。

{{<img src="detail.png" zoom=".5" title="ブコメ詳細画面">}}

### キーワードでブコメ抽出

たとえば「うんこ」とか入力するとコメント・タグに「うんこ」が含まれたものだけを抽出できます。

{{<img src="filter.png" zoom=".5" title="キーワード抽出">}}

気が向いたら該当箇所をハイライトするようにしたい。

### 共有機能

ブラウザなどで閲覧しているページに対して「ブコメを書く」「Satenaでブコメ一覧を閲覧する」「ブコメページをブラウザで閲覧する(URLをブコメページのURLに変換して共有する)」機能を提供している。

### ほか、色々細かめに設定可能

{{<img src="settings_entries.png" zoom=".5" title="エントリ設定">}}

{{<img src="settings_bookmarks.png" zoom=".5" title="ブコメ設定">}}

---

## 次バージョン開発状況

### version 1.3.0 (2020-08-12 時点)

#### ■エントリ一覧画面

- カテゴリ選択ドロワの表示形式を「リスト(従来)」と「テーブル」から選択できるようにした

{{<img src="categories_mode_dev_1.png" zoom=".5" title="上部が少し寂しい">}}

- ボタンや検索入力などを画面下部に集約するレイアウトモードを追加できそう  
    もちろん従来のレイアウトとどちらかをユーザーが選択できる。

{{<img src="bottom_layout_dev_2.png" zoom=".5" title="一番上までスクロールするボタンだけある画面。少し寂しい">}}

{{<img src="bottom_layout_dev_3.png" zoom=".5" title="マイブックマーク画面を開いたところ">}}

{{<img src="bottom_layout_dev_4.png" zoom=".5" title="マイブックマーク画面で検索している様子">}}

メニュー初期化処理を機械的に一括化できたので割と簡単にできた。よかったですね。

ブコメ一覧画面にも盛り込みたいけどあっちはもっと面倒くさそう。

#### ■フォント

- 各画面の特定ビューのフォントや文字サイズなどをユーザーが設定できる(ようになりそう)

#### ■設定のバックアップ

- 「設定をファイルに保存」「設定をファイルから読み込む」のファイル選択ダイアログを独自の物からストレージアクセスフレームワークに変更

- 不要になったファイル読み書きのパーミッションを削除

#### ■リリースノート

- 更新後最初の起動時に表示するダイアログでは、以前の利用バージョンから現在のバージョンまでの差分のみを表示するように変更

- インストール後初回起動時には表示しないように変更

---

## いつかその気になったらやりたいこと

### ブコメ一覧画面を開くためのURLが網羅しきれているかイマイチ自身がない

現在把握しているだけで次のパターンがある。  
たとえばGoogleのトップページ(url = https://www.google.com/ , eid = 18625960)の場合

1) https://b.hatena.ne.jp/entry/s/www.google.com/  
  (非SSLの場合は"/entry/www.google.com")

2) https://b.hatena.ne.jp/entry/https://www.google.com/

3) https://b.hatena.ne.jp/entry?url=https://www.google.com/

4) https://b.hatena.ne.jp/entry/18625960/

5) https://b.hatena.ne.jp/entry?eid=18625960

6) https://b.hatena.ne.jp/entry/18625960/comment/suihan74  
  (ユーザーのコメントへのリンク)

この他に把握していないパターンが存在していたらSatenaがクラッシュします（）  
これをいちいちアプリ側で判別しなくてもいいやりようもあるので、そういう方向に修正したい。なるはやで。

### マイブックマーク検索

~~エントリ画面を作り直した際に作り忘れてしまったので、近い内にマイブックマークのキーワード検索を復活させたい。~~

#### v1.2.22 (2020-08-03)

実装した。  
表示される検索結果がイマイチなのはアプリではなくはてなのせいなので諦めた。

### ボタンなどの操作対象を画面下部に集めたい

一般的なレイアウトは片手操作マンには正直使いづらい。  
タブとかツールバーボタンとか画面下の方に集約するオプションを作りたい。

#### v1.3.0

開発中。うまくいったら入れる。

### 横画面にしたときにビューがノッチに被らないようにしたい

ノッチの位置とサイズを取得するAPIはあるので、できないことはないけどちょっと面倒くさい。  
しなくても別に困らないし。

### ファイル入出力の新しい制限を反映する

~~API29以降では自由にディレクトリを行ったり来たり書いたり読んだりする使い方はやらないようにしてほしいらしい。  
少なくとも自分の端末ではまだ動くが、Deprecatedになっている以上早めに対応したい。~~

#### v1.3.0 (次バージョン)

次ので解決します。(一応できた)  
何故か独自で実装していたファイルピッカーダイアログをゴミ箱に捨てて、ストレージアクセスフレームワーク使うように変更。

### 重要度の低い警告発生個所の修正

クラッシュしたりとかは気付き次第、レポートが入り次第直しているが  
それ以外のたとえば「色の組み合わせが悪くて見づらいですよ」とかそういうやつ。  
あとはFloatingActionButtonの使い方とか不正な感じなのでそういう部分など。

### WebView版の内部ブラウザ

現状ではCustomTabsIntentを利用してChromeなどを内部ブラウザとして使用できるようにしている。  
ページ表示に関する処理をこちらで実装しなくていいので問題が起きたり性能に不満を抱くことは無い反面、画面下部に表示できる情報に強い制限があったり広告除去機能を付けたりとかができないなど自由度に少々の不満がある。

そんなわけで、どう考えても時代に逆行しているがWebViewを使って自前の内部ブラウザをいい感じに作れないかとたまに考える(そして面倒くさいから諦める)

### 言質取る男くん

「このユーザーはここではこんなこと言っていますが、以前はあんなことを言っていました」みたいのを調べるやつ。  
以前何パターンか試しに作ってはみたが、いまいちパッとしなくてリリースはしていない機能。

### 互助会スレイヤー

「n月のPV数xx達成！」みたいなタイトルのブログで、付いているブコメが「参考になります！」「すごいですね！」みたいな感じのばっかりで、それらにブログ主が★3つずつくらい付けてるタイプのエントリとユーザーを非表示にするやつ、こう書くとなんか機械的にできるんじゃないかみたいな気持ちにはなる。  
そういえば昔windows用に同じような(もっと雑な)アプリ作ったときに「指定ページとそこにブコメ付けたやつ全員ミュートする」とかいう乱暴な機能作ったことはあるが。。。

---

## 既知の(放置している)問題

### Google認証を使用したサインインに対応していない

所詮他所の人間が勝手に作ったものなので、この認証方式は使えないっぽい。なのでこの方法でアカウント作った人が興味持ってくれてもサインインできなくてガッカリしたりしているのかもしれないが、おれにはどうしようもないのだ。  
そういえば何故今どきOAuth認証でもなくBasicで認証しているのかというと、公開されているOAuth認証対応のAPIができること少ないため。(知らないだけで色々できるのか？)

### 遺物

コードの質がお察し。それに加え、使わなくなった部分やら取っ散らかっている部分やらを処分したい。

### (自分の)スマホ以外への表示最適化

だって持ってないんだもん。
