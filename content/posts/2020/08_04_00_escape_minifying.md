---
title: "HugoでSVGのminifyを回避する"
description: "pathタグの中身が圧縮されて表示がおかしくなった件"
tags: ["Hugo", "svg", "toml"]
date: 2020-08-04T20:26:07+09:00
lastmod: 2020-08-04T20:26:07+09:00
archives:
    - 2020
    - 2020-08
    - 2020-08-04
hide_overview: false
draft: false
---

## 要点

Hugoで```--minify```オプション付けてページ生成するとき、古いHugoを使っている場合や後述の設定を行っていない場合、インラインのSVGタグのパスデータが破壊される場合がある。  
バージョン```0.68.0```以上のHugoを使用し、```config.toml```にminify処理を制御するための記述をすることで解決できる。

---

## 発端

ブログテーマ中のアイコン部分を弄って、まぁこんな感じのアイコンを表示しようとしていた。↓

{{<img src="correct.png" title="(適当な切り貼り)">}}  

「うほ良い感じ」とか言ってノリノリでプッシュして、GitHub Actionが走って、出来上がったページを開いたらこんなんなっていた。↓

{{<img src="incorrect.png" title="なんか思ってたんと違う">}}

うほほ（白目をむいて倒れる）

## 原因

デバッグ用のローカル環境では、ソースファイルの圧縮を行っていなかったのでうまく動いていた。  
公開用の設定では圧縮を行っていることにより、ソースコード中のSVGのパスデータが破壊されていた。(大丈夫な場合もあるのが余計に厄介)

ブラウザの検証ツールを見てみると、

```Error: <path> attribute d: Expected number, "~~~"```

なるエラーが。  
ソースを表示して該当箇所を確認して、大丈夫な時と駄目な時のdiffをとった結果が以下。↓  
(上が表示が崩れる場合、下が正しく表示される場合)

{{<img src="comparison.png" title="視力検査">}}

そんなわけで、```--minify```切らないでなんとかする方法はないのかと探した結果が次。

## 対処方法

[Configure Minify - Configure Hugo - Hugo](https://gohugo.io/getting-started/configuration/#configure-minify)

バージョン```0.68.0```以降のHugoでは圧縮処理を制御できるようになっているらしい。  
これまで少し前のバージョンを使っていたので、とりあえず最新のものと置き換え、```config.toml```に次のセクションを追記した。

```toml
[minify]
  disableSVG = true
```

これにより、&lt;svg&gt;~~~&lt;/svg&gt;の内側でのコード圧縮が行われなくなり、パスデータもぶっ壊れることはなくなった。  

よかったですね。

---

上記のリンク先を見るに他のアセット用の設定も用意されているということは、これらも何かしらminifyで問題が発生することがあるということなんだろうか。不穏だ。
